<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projo-Connect Pro</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --secondary: #a855f7; --dark: #0f172a; --glass: rgba(255, 255, 255, 0.05); }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--dark); color: white; display: flex; height: 100vh; overflow: hidden; }
        #login-screen { position: fixed; inset: 0; background: radial-gradient(circle at center, #1e293b, #0f172a); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .main-app { display: none; flex: 1; width: 100%; }
        .sidebar { width: 280px; background: rgba(0,0,0,0.3); border-left: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 15px; font-size: 0.85rem; }
        .chat-input { padding: 10px; display: flex; gap: 5px; border-top: 1px solid rgba(255,255,255,0.1); }
        .content-zone { flex: 1; display: flex; flex-direction: column; padding: 15px; }
        .display-area { flex: 1; background: #000; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; }
        iframe, video, img { width: 100%; height: 100%; object-fit: contain; }
        .glass { background: var(--glass); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .btn { background: linear-gradient(135deg, var(--primary), var(--secondary)); border: none; color: white; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        input { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="glass">
        <h2>üìΩÔ∏è Projo-Connect</h2>
        <input type="text" id="userName" placeholder="Ton Nom"><br>
        <button class="btn" style="width: 100%;" onclick="createRoom()">‚ûï Cr√©er Salle (Prof)</button>
        <p style="font-size: 0.8rem; margin: 15px 0;">OU</p>
        <input type="text" id="roomIdInput" placeholder="Code √† 4 chiffres"><br>
        <button class="btn" style="width: 100%; background: #22c55e;" onclick="joinRoom()">üîó Rejoindre</button>
    </div>
</div>

<div id="main-app" class="main-app">
    <div class="content-zone">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span id="roomTitle" style="font-weight: bold; color: var(--primary);">Code: ----</span>
            <div id="prof-upload" class="hidden">
                <label for="fileFile" class="btn" style="background: #f59e0b; font-size: 0.8rem;">üìÅ Partager Fichier</label>
                <input type="file" id="fileFile" hidden onchange="uploadFile(this)">
            </div>
            <div style="font-size: 0.8rem;">üë• <span id="count">1</span></div>
        </div>
        <div class="display-area" id="screen">
            <p style="color: #444;">En attente du cours...</p>
        </div>
    </div>
    <div class="sidebar">
        <div class="chat-messages" id="chat"></div>
        <div class="chat-input">
            <input type="text" id="chatMsg" placeholder="Message..." style="flex:1; margin:0">
            <button class="btn" onclick="sendChat()">OK</button>
        </div>
    </div>
</div>

<script>
    // Connexion automatique au serveur actuel
    const socket = io();
    let currentRoom = "";
    let myName = "";
    let amIProf = false;

    function createRoom() {
        myName = document.getElementById('userName').value || "Prof";
        amIProf = true;
        socket.emit('create-room', myName);
    }

    function joinRoom() {
        myName = document.getElementById('userName').value || "√âl√®ve";
        currentRoom = document.getElementById('roomIdInput').value;
        socket.emit('join-room', { roomId: currentRoom, userName: myName });
    }

    socket.on('room-created', (data) => setupApp(data.roomId));
    socket.on('joined-success', (data) => setupApp(data.roomId));
    socket.on('error-msg', (msg) => alert(msg));

    function setupApp(id) {
        currentRoom = id;
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('roomTitle').innerText = "CODE: " + id;
        if(amIProf) document.getElementById('prof-upload').classList.remove('hidden');
    }

    function uploadFile(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const content = e.target.result;
            const type = file.type;
            renderContent(content, type);
            socket.emit('sync-content', { roomId: currentRoom, content, type });
        };
        reader.readAsDataURL(file);
    }

    socket.on('apply-content', (data) => renderContent(data.content, data.type));

    function renderContent(content, type) {
        const screen = document.getElementById('screen');
        if(type.includes('video')) screen.innerHTML = `<video src="${content}" controls autoplay></video>`;
        else if(type.includes('pdf')) screen.innerHTML = `<iframe src="${content}"></iframe>`;
        else screen.innerHTML = `<img src="${content}">`;
    }

    function sendChat() {
        const msg = document.getElementById('chatMsg').value;
        if(!msg) return;
        socket.emit('send-chat', { roomId: currentRoom, user: myName, msg });
        document.getElementById('chatMsg').value = "";
    }

    socket.on('new-chat', (data) => {
        const chat = document.getElementById('chat');
        chat.innerHTML += `<div><b style="color:var(--primary)">${data.user}:</b> ${data.msg}</div>`;
        chat.scrollTop = chat.scrollHeight;
    });

    socket.on('update-users', (count) => {
        document.getElementById('count').innerText = count;
    });
</script>
</body>
</html>
