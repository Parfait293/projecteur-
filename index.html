<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projo-Connect Pro</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --secondary: #a855f7; --dark: #0f172a; --glass: rgba(255, 255, 255, 0.05); }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--dark); color: white; display: flex; height: 100vh; overflow: hidden; }
        
        /* Layout */
        #login-screen { position: fixed; inset: 0; background: radial-gradient(circle at center, #1e293b, #0f172a); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .main-app { display: none; flex: 1; display: flex; width: 100%; }
        
        /* Sidebar Chat */
        .sidebar { width: 300px; background: rgba(0,0,0,0.3); border-left: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 15px; font-size: 0.85rem; }
        .chat-input { padding: 10px; display: flex; gap: 5px; }

        /* Projection Zone */
        .content-zone { flex: 1; display: flex; flex-direction: column; padding: 20px; position: relative; }
        .display-area { flex: 1; background: #000; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; }
        iframe, video, img { width: 100%; height: 100%; border: none; object-fit: contain; }

        /* Modern UI Elements */
        .glass { background: var(--glass); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .btn { background: linear-gradient(135deg, var(--primary), var(--secondary)); border: none; color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        input { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px; border-radius: 8px; }
        
        .floating-controls { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; }
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .emoji-btn { font-size: 1.5rem; cursor: pointer; transition: 0.2s; }
        .emoji-btn:hover { transform: scale(1.2); }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="glass" style="width: 350px; text-align: center;">
        <h1 style="margin-top:0">üìΩÔ∏è Projo Pro</h1>
        <input type="text" id="userName" placeholder="Ton Nom" style="width: 80%; margin-bottom: 10px;"><br>
        <button class="btn" style="width: 90%;" onclick="createRoom()">‚ûï Cr√©er Session (Prof)</button>
        <div style="margin: 20px 0; opacity: 0.5;">‚Äî OU ‚Äî</div>
        <input type="text" id="roomIdInput" placeholder="Code √† 4 chiffres" style="width: 80%; margin-bottom: 10px;"><br>
        <button class="btn" style="width: 90%; background: #22c55e;" onclick="joinRoom()">üîó Rejoindre</button>
    </div>
</div>

<div id="main-app" class="main-app">
    <div class="content-zone">
        <div class="status-bar">
            <div><span id="roomTitle" class="btn" style="background: rgba(255,255,255,0.1);">Code: ----</span></div>
            <div id="prof-upload" class="hidden">
                <label for="fileFile" class="btn" style="background: #f59e0b;">üìÅ Partager un cours</label>
                <input type="file" id="fileFile" hidden onchange="uploadFile(this)">
            </div>
            <div id="userListBadge">üë• <span id="count">1</span> participants</div>
        </div>

        <div class="display-area" id="screen">
            <h2 id="wait-msg">En attente du contenu du professeur...</h2>
        </div>

        <div class="floating-controls">
            <span class="emoji-btn" onclick="sendReaction('üî•')">üî•</span>
            <span class="emoji-btn" onclick="sendReaction('üëè')">üëè</span>
            <span class="emoji-btn" onclick="sendReaction('‚ùì')">‚ùì</span>
            <button class="btn" style="background: #ef4444;" onclick="raiseHand()">üñêÔ∏è Lever la main</button>
        </div>
    </div>

    <div class="sidebar">
        <h3 style="padding: 15px; margin: 0; border-bottom: 1px solid rgba(255,255,255,0.1);">Discussion</h3>
        <div class="chat-messages" id="chat"></div>
        <div class="chat-input">
            <input type="text" id="chatMsg" placeholder="Message..." style="flex:1">
            <button class="btn" onclick="sendChat()">OK</button>
        </div>
    </div>
</div>

<script>
    const socket = io();
    let currentRoom = "";
    let myName = "";
    let amIProf = false;

    // --- LOGIQUE SALLE ---
    function createRoom() {
        myName = document.getElementById('userName').value || "Prof";
        amIProf = true;
        socket.emit('create-room', myName);
    }

    function joinRoom() {
        myName = document.getElementById('userName').value || "√âl√®ve";
        currentRoom = document.getElementById('roomIdInput').value;
        socket.emit('join-room', { roomId: currentRoom, userName: myName });
    }

    socket.on('room-created', (data) => setupApp(data.roomId));
    socket.on('joined-success', (data) => setupApp(data.roomId));

    function setupApp(id) {
        currentRoom = id;
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('roomTitle').innerText = "CODE: " + id;
        if(amIProf) document.getElementById('prof-upload').classList.remove('hidden');
    }

    // --- LOGIQUE FICHIERS (Zoom Style) ---
    function uploadFile(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const content = e.target.result;
            const type = file.type;
            renderContent(content, type);
            socket.emit('sync-content', { roomId: currentRoom, content, type });
        };
        reader.readAsDataURL(file);
    }

    socket.on('apply-content', (data) => renderContent(data.content, data.type));

    function renderContent(content, type) {
        const screen = document.getElementById('screen');
        screen.innerHTML = "";
        if(type.includes('video')) screen.innerHTML = `<video src="${content}" controls autoplay></video>`;
        else if(type.includes('pdf')) screen.innerHTML = `<iframe src="${content}"></iframe>`;
        else screen.innerHTML = `<img src="${content}">`;
    }

    // --- CHAT & R√âACTIONS ---
    function sendChat() {
        const msg = document.getElementById('chatMsg').value;
        if(!msg) return;
        socket.emit('send-chat', { roomId: currentRoom, user: myName, msg });
        document.getElementById('chatMsg').value = "";
    }

    socket.on('new-chat', (data) => {
        const chat = document.getElementById('chat');
        chat.innerHTML += `<div><b>${data.user}:</b> ${data.msg}</div>`;
        chat.scrollTop = chat.scrollHeight;
    });

    function sendReaction(emoji) {
        socket.emit('send-chat', { roomId: currentRoom, user: myName, msg: "a r√©agi : " + emoji });
    }

    function raiseHand() {
        socket.emit('send-chat', { roomId: currentRoom, user: myName, msg: "üñêÔ∏è A lev√© la main !" });
    }

    socket.on('update-users', (users) => {
        document.getElementById('count').innerText = users.length + 1;
    });
</script>
</body>
</html>
